<% include ../partials/header %>

<div id="feed" class="container mt-2 mb-5">
    <div class="row justify-content-center">
        <h1>Go Share</h1>
    </div>
    <div class="row justify-content-center">
        <h1><img id="goodImage" src="https://github.com/matthewcline/gosharegood/blob/master/imgs/good.png?raw=true"></h1> 
    </div>
    <div class="row justify-content-center mt-4">
        <p>Highlighting stories of progress around the world.</p>
    </div>
    <div class="row mt-2 text-center">
        <div class="col-12">
            <a href="/posts/new">
                <button id="addBtn" type="button" class="btn btn-outline-secondary">
                    Add Post
                </button>
            </a>
        </div>
    </div>
    <hr class="mb-0">
    <% posts.forEach(post => { %>
    <div class="row justify-contents-center align-items-center">
        <!-- <div class="col-1">
            <div class="votes text-center"><%= post.votes || 0 %></div>
        </div> -->
        <div class="col-2">
            <div class="row justify-content-center">
                <form action="/posts/<%= post._id %>/votes?_method=PUT" method="POST">
                    <button type="submit" class="link-button">
                        <% if(currentUser && currentUser.votes.indexOf(post._id) !== -1) { %>
                            <img class="praisingHand clickedPraisingHand" src="https://github.com/matthewcline/gosharegood/blob/master/imgs/raisinghands.png?raw=true">
                        <% } else { %>
                            <img class="praisingHand" src="https://github.com/matthewcline/gosharegood/blob/master/imgs/raisinghands.png?raw=true">
                        <% } %>
                    </button>
                </form>
            </div>
            <div class="row justify-content-center mt-2">
                <div class="votes"><%= post.votes || 0 %></div>
            </div>
        </div>
        <div class="col-10 pt-3">
            <% var title = post.title.length < 130 ? post.title : `${post.title.substring(0, 130)}...` %>
            <a class="postLinkTitle" href="/posts/<%= post._id %>">
                <p class="mb-0"><%= title %></p>
            </a>
        <% if(post.url){ %>
            <% var url = post.url.length < 70 ? post.url : `${post.url.substring(0, 70)}...` %>
            <a class="url postLink" href="<%= post.url %>" target="_blank"><%= url %></a>
        <% } else if(post.description) { %>
            <p><%= post.description.substring(0, 70) %>...</p>
        <% }%>
            <p class="postedBy mt-1">
                Posted by <%= post.author.username %>
                <%  
                function getTimeSinceCreated(timeCreated) {
                    const milliSeconds = Date.now() - timeCreated;
                    const seconds = Math.floor(milliSeconds/1000);
                    const minutes = Math.floor(seconds/60);
                    const hours = Math.floor(minutes/60);
                    const days = Math.floor(minutes/1440);
                    if(seconds < 3600) {
                        return `${minutes} minutes ago`;
                    } else if(seconds < 7200) {
                        return "1 hour ago";
                    } else if(seconds < 86400) {
                        return `${hours} hours ago`;
                    } else if(seconds < 172800) {
                        return  "1 day ago";
                    } else {
                        return `${days} days ago`
                    }
                } 
                %>
                <% if(post.timeCreated) { %>
                <span class="ml-2"><%= getTimeSinceCreated(post.timeCreated) || "" %></span>
                <% } %>
            </p>
        </div>
    </div>
    <hr class="my-0">
    <% }); %>
    
</div>

<% include ../partials/footer %>